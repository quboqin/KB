---
import BaseLayout from '@/layouts/BaseLayout.astro';
import PostList from '@/components/blog/PostList.astro';
import TagCloud from '@/components/ui/TagCloud.astro';
import RSSLink from '@/components/widgets/RSSLink.astro';
import { getAllPosts, getAllTags, getAllCategories } from '@/utils/posts';

const posts = await getAllPosts();
const tags = await getAllTags();
const categories = await getAllCategories();

const categoryIcons: Record<string, string> = {
  'æŠ€æœ¯': 'ğŸ’»', 'é‡‘è': 'ğŸ“ˆ', 'AI': 'ğŸ¤–', 'ç”Ÿæ´»': 'ğŸŒ±', 'å…¶ä»–': 'ğŸ“Œ',
};
---

<BaseLayout title="é¦–é¡µ">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Hero -->
    <section class="text-center mb-16">
      <h1 class="text-4xl sm:text-5xl font-medium text-slate-900 dark:text-white mb-4 leading-tight">
        ğŸ§  KB with AI
      </h1>
      <p class="text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">
        æ¢ç´¢ AI ä¸çŸ¥è¯†ç®¡ç†çš„è¾¹ç•Œï¼Œè®°å½•å­¦ä¹ ä¸æ€è€ƒ
      </p>
      <div class="mt-6 flex items-center justify-center gap-4 flex-wrap">
        <a href="#posts"
           class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-medium hover:bg-indigo-700 transition-colors">
          æµè§ˆæ–‡ç« 
        </a>
        <RSSLink />
      </div>
    </section>

    <!-- Category Nav -->
    {categories.length > 0 && (
      <section class="mb-10">
        <h2 class="text-lg font-medium text-slate-900 dark:text-white mb-4">åˆ†ç±»</h2>
        <div class="flex flex-wrap gap-3">
          {categories.map(({ name, count }) => (
            <a
              href={`/categories/${name}`}
              class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-indigo-100 hover:text-indigo-700 dark:hover:bg-indigo-900/40 dark:hover:text-indigo-400 font-medium text-sm transition-colors"
            >
              <span>{categoryIcons[name] ?? 'ğŸ“‚'}</span>
              <span>{name}</span>
              <span class="text-xs text-slate-400 dark:text-slate-500">({count})</span>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Tag Cloud -->
    {tags.length > 0 && (
      <section class="mb-12">
        <h2 class="text-lg font-medium text-slate-900 dark:text-white mb-4">çƒ­é—¨æ ‡ç­¾</h2>
        <TagCloud tags={tags.slice(0, 20)} />
      </section>
    )}

    <!-- Posts Grid -->
    <section id="posts">
      <h2 class="text-2xl font-medium text-slate-900 dark:text-white mb-8">æœ€æ–°æ–‡ç« </h2>
      {posts.length > 0 ? (
        <PostList posts={posts} />
      ) : (
        <div class="text-center py-20 text-slate-400 dark:text-slate-500">
          <p class="text-lg">è¿˜æ²¡æœ‰æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…</p>
        </div>
      )}
    </section>
  </div>
</BaseLayout>
