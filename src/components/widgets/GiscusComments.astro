---
const repo = import.meta.env.GISCUS_REPO ?? 'your-org/your-repo';
const repoId = import.meta.env.GISCUS_REPO_ID ?? '';
const category = import.meta.env.GISCUS_CATEGORY ?? 'General';
const categoryId = import.meta.env.GISCUS_CATEGORY_ID ?? '';
---

<section class="mt-16 pt-12 border-t border-slate-200 dark:border-slate-700">
  <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-8">评论</h2>
  <div id="giscus-container">
    <script
      src="https://giscus.app/client.js"
      data-repo={repo}
      data-repo-id={repoId}
      data-category={category}
      data-category-id={categoryId}
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="preferred_color_scheme"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async
    ></script>
  </div>
</section>

<script>
  // Sync giscus theme with site dark/light mode
  function syncGiscusTheme() {
    const isDark = document.documentElement.classList.contains('dark');
    const iframe = document.querySelector<HTMLIFrameElement>('.giscus-frame');
    if (iframe?.contentWindow) {
      iframe.contentWindow.postMessage(
        { giscus: { setConfig: { theme: isDark ? 'dark' : 'light' } } },
        'https://giscus.app'
      );
    }
  }

  const observer = new MutationObserver(syncGiscusTheme);
  observer.observe(document.documentElement, { attributeFilter: ['class'] });
</script>
